import{r as l,x as I,j as e,Q as V,t as E,S as f}from"./app-DCZ52RW6.js";import{S as v}from"./StatusBadge-D6v05-0G.js";import{P as c}from"./PrimaryButton-DOyy9Dyj.js";import{S as d}from"./dialog-XyKRiAT6.js";import{M as m}from"./Modal-D-VxgzEK.js";import{A as F}from"./AttachmentViewer-tmAb_bEt.js";import"./transition-Bb7mg3oO.js";function O({appointment:s,activities:b}){const[p,i]=l.useState(!1),[w,n]=l.useState(!1),[_,o]=l.useState(!1),[u,N]=l.useState(""),[h,y]=l.useState(""),[C,x]=l.useState(!1),[a,j]=l.useState(!1),t=I({admin_notes:s.admin_notes||"",preferred_date:s.preferred_date,preferred_time:s.preferred_time}),k=()=>{x(!0)},S=()=>{j(!0),f.post(route("admin.appointments.accept",s.id),{},{onSuccess:()=>{j(!1),x(!1)},onError:()=>{j(!1),alert("Une erreur est survenue lors de l'acceptation du rendez-vous.")}})},A=()=>{if(!u.trim()){alert("Veuillez indiquer une raison de refus.");return}f.post(route("admin.appointments.reject",s.id),{rejection_reason:u}),i(!1),N("")},z=()=>{if(!h.trim()){alert("Veuillez indiquer une raison d'annulation.");return}f.post(route("admin.appointments.cancel",s.id),{admin_notes:h}),n(!1),y("")},M=()=>{t.put(route("admin.appointments.update",s.id),{onSuccess:()=>{o(!1)}})},D=r=>({pending:"orange",accepted:"green",rejected:"red",canceled:"gray",canceled_by_requester:"gray",expired:"gray",completed:"blue"})[r]||"gray",R=r=>({normal:"gray",urgent:"red",official:"blue"})[r]||"gray",q=r=>{switch(r){case"normal":return"Normal";case"urgent":return"Urgent";case"official":return"Officiel";default:return"Inconnu"}};return e.jsxs(e.Fragment,{children:[e.jsx(V,{title:`Rendez-vous - ${s.subject}`}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b mb-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Détail du rendez-vous"}),e.jsx("p",{className:"text-gray-600 mt-2",children:s.subject})]}),e.jsx(E,{href:route("admin.appointments.index"),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"← Retour à la liste"})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Informations du rendez-vous"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{status:s.formatted_status,color:D(s.status)}),e.jsx(v,{status:s.formatted_priority,color:R(s.priority)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Demandeur"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-900",children:[e.jsx("strong",{children:"Nom :"})," ",s.name]}),e.jsxs("p",{className:"text-sm text-gray-900",children:[e.jsx("strong",{children:"Email :"})," ",s.email]}),e.jsxs("p",{className:"text-sm text-gray-900",children:[e.jsx("strong",{children:"Téléphone :"})," ",s.phone]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Détails"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-900",children:[e.jsx("strong",{children:"Date souhaitée :"})," ",s.preferred_date]}),e.jsxs("p",{className:"text-sm text-gray-900",children:[e.jsx("strong",{children:"Heure souhaitée :"})," ",s.preferred_time]}),e.jsxs("p",{className:"text-sm text-gray-900",children:[e.jsx("strong",{children:"Date de soumission :"})," ",s.created_at]}),s.processed_by&&e.jsxs("p",{className:"text-sm text-gray-900",children:[e.jsx("strong",{children:"Traité par :"})," ",s.processed_by.name]})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Objet"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.subject})]}),s.message&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Message"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-gray-700",children:s.message})})]}),e.jsx(F,{attachments:s.attachments,appointmentId:s.id}),s.status==="pending"&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Actions"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(c,{onClick:k,disabled:a,children:a?"Traitement...":"Accepter"}),e.jsx(d,{onClick:()=>i(!0),disabled:a,children:"Refuser"}),e.jsx(d,{onClick:()=>n(!0),disabled:a,children:"Annuler"}),e.jsx(d,{onClick:()=>o(!0),disabled:a,children:"Modifier"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Historique des actions"}),b.length>0?e.jsx("div",{className:"space-y-4",children:b.map((r,g)=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900",children:r.formatted_description}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r.time_ago})]})]},g))}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucune activité enregistrée pour le moment."})})]})]}),e.jsxs("div",{className:"lg:col-span-1",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Notes administratives"}),s.admin_notes?e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-blue-800",children:s.admin_notes})}):e.jsx("p",{className:"text-sm text-gray-500",children:"Aucune note administrative."})]}),s.rejection_reason&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Raison du refus"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-red-800",children:s.rejection_reason})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informations système"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ID :"})," ",s.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Token :"})," ",e.jsx("code",{className:"text-xs bg-gray-100 px-1 rounded",children:s.secure_token})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"IP :"})," ",s.ip_address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Créé le :"})," ",s.created_at]}),s.updated_at!==s.created_at&&e.jsxs("p",{children:[e.jsx("strong",{children:"Modifié le :"})," ",s.updated_at]})]})]})]})]})})]}),e.jsx(m,{show:p,onClose:()=>i(!1),maxWidth:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Refuser le rendez-vous"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Veuillez indiquer la raison du refus pour le rendez-vous de ",s.name,"."]}),e.jsx("textarea",{value:u,onChange:r=>N(r.target.value),placeholder:"Raison du refus...",className:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",rows:"4"}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx(d,{onClick:()=>i(!1),children:"Annuler"}),e.jsx(c,{onClick:A,children:"Confirmer le refus"})]})]})}),e.jsx(m,{show:w,onClose:()=>n(!1),maxWidth:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Annuler le rendez-vous"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Veuillez indiquer la raison de l'annulation pour le rendez-vous de ",s.name,"."]}),e.jsx("textarea",{value:h,onChange:r=>y(r.target.value),placeholder:"Raison de l'annulation...",className:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",rows:"4"}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx(d,{onClick:()=>n(!1),children:"Annuler"}),e.jsx(c,{onClick:z,children:"Confirmer l'annulation"})]})]})}),e.jsx(m,{show:_,onClose:()=>o(!1),maxWidth:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Modifier le rendez-vous"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date souhaitée"}),e.jsx("input",{type:"date",value:t.data.preferred_date,onChange:r=>t.setData("preferred_date",r.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Heure souhaitée"}),e.jsx("input",{type:"time",value:t.data.preferred_time,onChange:r=>t.setData("preferred_time",r.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes administratives"}),e.jsx("textarea",{value:t.data.admin_notes,onChange:r=>t.setData("admin_notes",r.target.value),placeholder:"Notes administratives...",className:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500",rows:"4"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx(d,{onClick:()=>o(!1),children:"Annuler"}),e.jsx(c,{onClick:M,disabled:t.processing,children:t.processing?"Modification...":"Enregistrer"})]})]})}),e.jsx(m,{show:C,onClose:()=>!a&&x(!1),maxWidth:"md",children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"text-center",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4",children:e.jsxs("svg",{className:"animate-spin h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Traitement en cours..."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Mise à jour du statut"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"text-sm text-gray-600",children:"Envoi de l'email de confirmation"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse",style:{animationDelay:"0.4s"}}),e.jsx("span",{className:"text-sm text-gray-600",children:"Finalisation..."})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Veuillez patienter, cette opération peut prendre quelques secondes."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4",children:e.jsx("svg",{className:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Accepter le rendez-vous"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:["Êtes-vous sûr de vouloir accepter le rendez-vous de ",e.jsx("strong",{children:s.name})," ?"]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Détails du rendez-vous :"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Objet :"})," ",s.subject]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date :"})," ",s.preferred_date?new Date(s.preferred_date).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"Non définie"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Heure :"})," ",s.preferred_time||"Non définie"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Priorité :"})," ",s.priority?q(s.priority):"Non définie"]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mb-6",children:"Un email de confirmation sera automatiquement envoyé au demandeur."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(d,{onClick:()=>x(!1),disabled:a,children:"Annuler"}),e.jsx(c,{onClick:S,disabled:a,className:"bg-green-600 hover:bg-green-700 focus:ring-green-500",children:"Accepter le rendez-vous"})]})]})})})})]})}export{O as default};
